<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>InsightPulse</title>
<meta name="description" content="Upload a CSV and instantly see KPIs, charts, and a table. 100% client-side.">
<style>
:root{--bg:#000;--surface:#050a0a;--muted:#0d1c1c;--text:#eaffff;--sub:#a5f7f1;--teal2:#1ca5a5;--teal3:#26d9cf;--mint:#4afff0}
html,body{height:100%}
body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);
background:linear-gradient(135deg,#001212,#002626,#001212);background-size:400% 400%;animation:g 20s ease infinite}
@keyframes g{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
*{box-sizing:border-box}
header{background:linear-gradient(135deg,#146b6b,var(--teal2),var(--teal3));text-align:center;padding:2rem 1rem}
header h1{margin:0;color:var(--mint);font-size:2.2rem}
nav{display:flex;justify-content:center;gap:.5rem;background:linear-gradient(135deg,var(--teal2),var(--teal3))}
nav a{color:#fff;text-decoration:none;padding:1rem 1.25rem;border-radius:10px}
nav a:hover{background:rgba(74,255,240,.15)}
section{padding:2rem 1rem;max-width:1100px;margin:auto}
h2{color:var(--mint);margin:0 0 .75rem}
.card,.chart,.kpi,.table{background:#050a0a;border:1px solid var(--muted);border-radius:12px;padding:1rem;box-shadow:0 0 14px rgba(38,217,207,.4),0 0 28px rgba(74,255,240,.15)}
.row{display:flex;gap:1rem;flex-wrap:wrap;align-items:center}
.btn{display:inline-block;padding:.9rem 1.1rem;border:1px dashed var(--teal3);border-radius:12px;color:var(--mint);background:#031515;text-decoration:none;cursor:pointer}
.btn:hover{background:#052020}
.badge{display:inline-block;margin-left:.5rem;background:#072222;border:1px solid #178;border-radius:999px;padding:.2rem .55rem;color:var(--mint);font-size:.85rem}
.kpi{flex:1 1 180px;text-align:center}
.kpi .v{font-size:2rem;color:var(--mint);font-weight:800}
.kpi .l{color:var(--sub)}
.chart{flex:1 1 320px}
.chart svg{width:100%;height:220px;background:#000;border:1px solid #178;border-radius:10px}
table{width:100%;border-collapse:collapse;color:#eaffff}
th,td{padding:.6rem;border-bottom:1px solid #178;text-align:left;white-space:nowrap}
th{color:var(--mint);background:#021111}
.dropzone{border:2px dashed var(--teal3);border-radius:14px;padding:1.1rem;text-align:center;color:#a5f7f1;background:#021616;margin:.8rem 0 0;user-select:none;display:block}
.dropzone strong{color:var(--mint)}
.dropzone.drag{background:#062222;box-shadow:0 0 16px rgba(74,255,240,.5)}
/* the real input stays in DOM (iOS-safe) but is offscreen */
#csvPicker{position:absolute;left:-9999px;width:1px;height:1px;opacity:0.01}
footer{background:#001414;text-align:center;padding:1rem;color:var(--mint);margin-top:2rem}
</style>
</head>
<body>
<header>
  <h1>InsightPulse</h1>
  <p>Upload a CSV to see KPIs, charts and a table — fully client-side. <span class="badge">Build: FIX-CSV-01</span></p>
</header>

<nav>
  <a href="#liveapp">Live App</a>
  <a href="#pricing">Pricing</a>
  <a href="#faq">FAQ</a>
</nav>

<section id="liveapp">
  <h2>Live App</h2>

  <!-- One real, native input (guaranteed to open on iPad/Chrome) -->
  <input id="csvPicker" type="file" accept=".csv,text/csv,text/plain,application/vnd.ms-excel"/>

  <div class="card row" style="justify-content:flex-start;gap:.8rem">
    <!-- Get started opens the same picker -->
    <label for="csvPicker" class="btn">Get started</label>
    <a href="#" class="btn" id="demoBtn">See it in action</a>
    <!-- Visible fallback button (also opens picker) -->
    <label for="csvPicker" class="btn">Choose CSV</label>
    <a href="data:text/csv,Month,Revenue%0AJan,12000%0AFeb,14100%0AMar,15750%0AApr,17040%0AMay,16660%0AJun,18220%0AJul,19510"
       download="sample.csv" class="btn" style="text-decoration:underline;border-style:solid">Download sample CSV</a>
  </div>

  <!-- Drop area is a LABEL bound to the input (rock-solid on iOS/Chrome) -->
  <label for="csvPicker" id="dropZone" class="dropzone" role="button" aria-label="Upload CSV">
    <strong>Drop your CSV file here</strong> — or tap anywhere in this box to choose a file
  </label>

  <div class="row" style="margin-top:1rem">
    <div class="kpi card"><div class="v" id="k1">0</div><div class="l">Total</div></div>
    <div class="kpi card"><div class="v" id="k2">0</div><div class="l">Average ×100</div></div>
    <div class="kpi card"><div class="v" id="k3">0%</div><div class="l">Growth</div></div>
  </div>

  <div class="row" style="margin-top:1rem">
    <div class="chart card"><svg id="line"></svg></div>
    <div class="chart card"><svg id="bars"></svg></div>
  </div>

  <div class="table card" style="margin-top:1rem">
    <table id="tbl"><thead></thead><tbody></tbody></table>
  </div>
</section>

<section id="pricing" class="card">
  <h2>Pricing</h2>
  <p style="color:#a5f7f1">Exclusive acquisition package available.</p>
</section>

<section id="faq" class="card">
  <h2>FAQ</h2>
  <p><b>Offline?</b> Yes — one HTML file.</p>
  <p><b>Private?</b> 100% client-side parsing.</p>
</section>

<footer>&copy; <span id="y"></span> InsightPulse</footer>

<script>
document.getElementById('y').textContent=new Date().getFullYear();

// Smooth scroll for in-page links (e.g., nav)
document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click',e=>{
    const id=a.getAttribute('href').slice(1);
    const el=document.getElementById(id);
    if(el){ e.preventDefault(); el.scrollIntoView({behavior:'smooth'}); }
  });
});

// Elements
const picker=document.getElementById('csvPicker');
const drop=document.getElementById('dropZone');
const demoBtn=document.getElementById('demoBtn');

// Read CSV after user selects a file
if(picker){
  picker.addEventListener('change',e=>{
    const f=e.target.files&&e.target.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=ev=>{ const rows=parseCSV(String(ev.target.result||'')); renderAll(rows); };
    r.readAsText(f);
  });
}

// Desktop drag & drop (mobile can ignore it)
if(drop){
  ['dragenter','dragover'].forEach(t=>drop.addEventListener(t,e=>{e.preventDefault();drop.classList.add('drag');}));
  ['dragleave','dragend','drop'].forEach(t=>drop.addEventListener(t,e=>{e.preventDefault();drop.classList.remove('drag');}));
  drop.addEventListener('drop',e=>{
    const f=e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=ev=>{ const rows=parseCSV(String(ev.target.result||'')); renderAll(rows); };
    r.readAsText(f);
  });
}

// Demo data
if(demoBtn){
  demoBtn.addEventListener('click',e=>{
    e.preventDefault();
    const csv=`Month,Revenue
Jan,12000
Feb,14100
Mar,15750
Apr,17040
May,16660
Jun,18220
Jul,19510
Aug,20500
Sep,21150
Oct,22620
Nov,23990
Dec,25550`;
    renderAll(parseCSV(csv));
  });
}

// CSV + render helpers
function parseCSV(t){
  const lines=t.trim().split(/\r?\n/);
  return lines.map(line=>{
    const out=[];let cur='',q=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='"'){q=!q;}
      else if(ch===','&&!q){out.push(cur);cur='';}
      else{cur+=ch;}
    }
    out.push(cur);
    return out.map(c=>c.replace(/^"|"$/g,''));
  });
}
function firstNumCol(rows){
  if(rows.length<2) return -1;
  for(let c=1;c<rows[0].length;c++){
    if(rows.slice(1).some(r=>!isNaN(parseFloat(r[c])))) return c;
  }
  return -1;
}
function renderAll(rows){
  if(!rows||!rows.length) return;
  const n=firstNumCol(rows);
  renderTable(rows);
  if(n!==-1){updateKPIs(rows,n);drawLine(rows,n);drawBars(rows,n);}
  document.getElementById('liveapp').scrollIntoView({behavior:'smooth'});
}
function renderTable(rows){
  const th=document.querySelector('#tbl thead'), tb=document.querySelector('#tbl tbody');
  th.innerHTML='<tr>'+rows[0].map(h=>`<th>${h}</th>`).join('')+'</tr>';
  tb.innerHTML=rows.slice(1).map(r=>'<tr>'+r.map(c=>`<td>${c}</td>`).join('')+'</tr>').join('');
}
function updateKPIs(rows,n){
  const xs=rows.slice(1).map(r=>parseFloat(r[n])).filter(x=>!isNaN(x)); if(!xs.length) return;
  const sum=xs.reduce((a,b)=>a+b,0), avg=sum/xs.length, growth=xs[0]?((xs.at(-1)-xs[0])/Math.abs(xs[0]))*100:0;
  document.getElementById('k1').textContent=sum.toFixed(2);
  document.getElementById('k2').textContent=(avg*100).toFixed(2);
  document.getElementById('k3').textContent=growth.toFixed(2)+'%';
}
function clear(svg){while(svg.firstChild) svg.removeChild(svg.firstChild);}
function drawLine(rows,n){
  const svg=document.getElementById('line'); clear(svg);
  const xs=rows.slice(1).map(r=>parseFloat(r[n])).filter(x=>!isNaN(x)); if(!xs.length) return;
  const W=svg.clientWidth||600,H=220,min=Math.min(...xs),max=Math.max(...xs),rng=(max-min)||1;
  for(let i=0;i<=4;i++){const y=(i/4)*H;const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',0);ln.setAttribute('x2',W);ln.setAttribute('y1',y);ln.setAttribute('y2',y);
    ln.setAttribute('stroke','#134c4c');ln.setAttribute('stroke-width','1');svg.appendChild(ln);}
  const pts=xs.map((v,i)=>`${(i/Math.max(1,xs.length-1))*W},${H-((v-min)/rng)*H}`).join(' ');
  const p=document.createElementNS('http://www.w3.org/2000/svg','polyline');
  p.setAttribute('fill','none');p.setAttribute('stroke','#4afff0');p.setAttribute('stroke-width','2');p.setAttribute('points',pts);svg.appendChild(p);
}
function drawBars(rows,n){
  const svg=document.getElementById('bars'); clear(svg);
  const xs=rows.slice(1).map(r=>parseFloat(r[n])).filter(x=>!isNaN(x)); if(!xs.length) return;
  const W=svg.clientWidth||600,H=220,max=Math.max(...xs)||1,slot=W/xs.length,barW=Math.max(1,slot-3);
  for(let i=0;i<=4;i++){const y=(i/4)*H;const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',0);ln.setAttribute('x2',W);ln.setAttribute('y1',y);ln.setAttribute('y2',y);
    ln.setAttribute('stroke','#134c4c');ln.setAttribute('stroke-width','1');svg.appendChild(ln);}
  xs.forEach((v,i)=>{const h=(v/max)*H,x=i*slot+(slot-barW)/2,y=H-h;const r=document.createElementNS('http://www.w3.org/2000/svg','rect');
    r.setAttribute('x',x);r.setAttribute('y',y);r.setAttribute('width',barW);r.setAttribute('height',h);
    r.setAttribute('fill','#26d9cf');r.setAttribute('rx','4');svg.appendChild(r);});
}
</script>
</body>
</html>
